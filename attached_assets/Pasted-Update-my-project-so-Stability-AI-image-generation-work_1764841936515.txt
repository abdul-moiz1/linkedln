Update my project so Stability AI image generation works correctly.
The API key is already correct.
The issue is the wrong endpoint and missing Accept: image/*.
Fix ONLY the backend image generation route.

Do the following:

1. Replace the entire /api/images/generate route with this working version

Use Stable Diffusion Core endpoint:

POST https://api.stability.ai/v2beta/stable-image/generate/core


This is the only free endpoint that returns PNG output without billing.

Implement this complete working code:

import express from "express";
import fetch from "node-fetch";

const router = express.Router();

router.post("/generate", async (req, res) => {
  try {
    const { slides } = req.body;

    if (!slides || slides.length === 0) {
      return res.status(400).json({
        success: false,
        error: "Slides are required"
      });
    }

    const apiKey = process.env.STABILITY_API_KEY;
    const images = [];

    for (const text of slides) {
      const response = await fetch(
        "https://api.stability.ai/v2beta/stable-image/generate/core",
        {
          method: "POST",
          headers: {
            Authorization: `Bearer ${apiKey}`,
            "Content-Type": "application/json",
            Accept: "image/*"
          },
          body: JSON.stringify({
            prompt: text + ", professional modern illustration, clean design, high quality"
          })
        }
      );

      if (!response.ok) {
        console.log("Stability error:", await response.text());
        throw new Error("Image generation failed for: " + text);
      }

      const buffer = await response.arrayBuffer();
      const base64 = Buffer.from(buffer).toString("base64");
      images.push(base64);
    }

    res.json({ success: true, images });
  } catch (err) {
    console.error("SERVER ERROR:", err);
    res.status(500).json({ success: false, error: err.message });
  }
});

export default router;

2. Do NOT change anything else

Leave frontend as it is

Leave provider UI as it is

Leave all PDF + LinkedIn code untouched

Update only the backend route shown above

3. Expected result

After updating:

Clicking Generate Images returns 1 image per slide

No more “No images were generated”

No more Stability errors

No billing required